# 암호화

> SHA, RSA, AES

컴퓨터, 휴대폰 등 전자 기기에 금융 정보, 개인정보들을 넣어 놓는데, 이러한 정보들은 외부에서 해킹을 하면 안되기 때문에 개발자들이 해당 정보들을 암호화 해야 한다.

이러한 정보들을 암호화 처리할 경우 해당 정보를 읽을 수 없는 형식으로 변환을 하게 되는데, 이를 암호문이라고 부르며 해당 정보에 접근하기 위해서는 암호화 키가 필요하다.

이 암호화 키를 이용하여 암호화 한것을 복화하하고 해당 정보들을 해당 키를 이용하여 암호화 할 수 있는 것이다.

현재 최고 수준의 암호 방식은 256bit, 128bit 이다.

![AES & SHA-256 암호화란 ? (개념 / 종류 / 특징) - undefined - undefined - 암호화 구조](https://blog.kakaocdn.net/dn/vfYBc/btruK6iZ1V9/kfSicx86WPHRUVhECultn0/img.png)



## SHA

> 복호화 되지 않는 암호화 방법
>
> 대칭키 암호화 방식
>
> 미국 NSA가 제작하고 미국 국립표준기술연구소(NIST) 에서 표준으로 제작한 해시 암호 알고리즘

로그인 하지 않은 유저가 로그인을 위해 비밀번호를 받는데, 비밀번호는 본인만 알고 있어야 하므로, 복호화가 되지 않는 암호화 방법을 채택했다.

복호화가 되지 않는 암호화 방법 중 유명한 것은 SHA 시리즈 이다.

SHA는 미국 NSA가 제작하고 미국 국립표준기술연구소(NIST) 에서 표준으로 제작한 해시 암호 알고리즘이다.

SHA-0, SHA-1 버전을 거져 SHA-2 를 많이 쓰는데, 

SHA-2 에는 SHA-224, SHA-256, SHA-384, SHA-512 등의 종류가 있다.



현재 자주쓰는 SHA-2 중에서도 대표적으로 인터넷 뱅킹, 비트코인 등에 쓰이는 SHA-256 을 채택했다.

SHA-2의 특징은 어떤 문자열을 암호화 할 때, "동일한 문자열"은 항상 동일한 다이제스트(해시 함수가 출력하는 압축된 문장)를 출력하고, "다른 문자열"은 항상 다른 다이제스트를 추력한다.

이 중 SHA-256은 다이제스트 출력 값이 256 bit 인것을 말한다. (SHA-512 = 512 bit)



"다른 문자열" 이라는 경우의 수는 매우 많아 다른 문자열임에도 다이제스트가 충돌할 수 있는데, SHA-256만 하더라도 2^256 이라는 어마무시한 경우의 수를 제공하여 충돌 가능성이 매우매우 적다고 한다. (관측 가능한 우주의 모든 원자수 보다 크다고 주장)



우리는 이 SHA-256을 이용해, 비회원이 어떤 패스워드를 등록하더라도 SHA-256 을 통해 나온 다이제스트를 (256bit 해싱 값) RDB에 저장하므로써 비회원이 등록한 패스워드를 본인이 아니면, 누구도 모르게 했다.



## RSA

> 비대칭키 암호화 방식

비대칭키 라는 것은 암호화 할 때 키, 복호화할 때 키가 다르다는 의미이다.

암호화할 때 키를 "공개키", 복호화 할 때 키를 "개인키" 라고 한다.

클라이언트에서 가지고 잇는 정보를 서버로 보낼 때, 스니핑 등으로 데이터가 노출되면 안되므로 클라이언트가 가지고 있는 "공개키"로 데이터를 암호화하여, 서버로 전달한다.



다만, 암호화 가능한 길이가 딱 245 byte 까지 이므로, 긴 문자열을 암호화하는데는 적합하지 않다.



만약 JSON 데이터를 주고 받고 싶은데, 문자열 길이가 제한이 된다면, 아래 AES 암호화를 섞어서 사용한다.



## AES

> Advnaced Encryption Standard
>
> "대칭키" 라는 임의의 키를 만들어서, 암호화하고자 하는 "문자열"을 "대칭키" 라는 키로 암호화 하는 방식



암호화 키의 길이에 따라 AES-128, AES-192, AES-256 종류가 있다.

SHA 처럼 AES 뒤의 숫자가 bit 길이이다.



위의 비대칭키와 다르게 "대칭키" 하나로 암호화, 복호화 모두 진행하는 방식이다. (같은 키를 가지고 암복호화 진행)

특히 문자열 길이에 상관없이 암호화가 가능하다.



### RSA, AES 함께 사용

>  만약 245 byte를 초과하는 JSON 데이터 (긴 문자열) 를 클라이언트와 서버 간 주고 받아야 할 떄

긴 문자열 때문에 RSA로 암호화해서 데이터를 보낼 수 없을 떄

1. RSA 공개키, 개인키를 서버에서 생성해서 클라이언트에게 "공개키"를 알려준다.

   (통신할 때 마다 매번 공개키, 암호키를 생성하지 않고, 한 번만 생성)

2. 클라이언트는 "공개키"를 안전한 장소에 보관하고, 서버는 "개인키"를 안전한 장소에 보관

3. 클라이언트에서 서버로 데이터를 보낼 때, AES 대칭키를 생성

   이 대칭키로 서버로 보낼 데이터를 AES 암호화 한다.

4. 서버에서 클라이언트가 생성한 AES 대칭키를 알고 있어야 전달받은 데이터를 복호화 할 수 있다.

   때문에 클라이언트에서 AES 대칭키를 안전한 장소에 보관된 "공개키"로 RSA 암호화를 진행

5. 서버에서는 RSA 암호화된 AES 대칭키를 "개인키"로 RSA 복호화하고,

   복호화된 AES 대칭키로 실제 데이터를 AES 복호화



---

참고사이트

위키 : http://wiki.hash.kr/index.php/SHA256

티스토리 : https://stage-loving-developers.tistory.com/23

https://jeongkyun-it.tistory.com/91